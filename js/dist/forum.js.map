{"version":3,"sources":["webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['extend']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['app']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['components/HeaderSecondary']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['components/SettingsPage']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['components/Button']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['components/LogInModal']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['components/Modal']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['components/SignUpModal']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['components/LogInButtons']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['utils/extractText']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['utils/ItemList']\"","webpack://@tituspijean/auth-ldap/external \"flarum.core.compat['utils/Stream']\"","webpack://@tituspijean/auth-ldap/./src/forum/components/LDAPLogInModal.js","webpack://@tituspijean/auth-ldap/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@tituspijean/auth-ldap/./src/forum/index.js","webpack://@tituspijean/auth-ldap/webpack/bootstrap","webpack://@tituspijean/auth-ldap/webpack/startup","webpack://@tituspijean/auth-ldap/webpack/runtime/compat get default export","webpack://@tituspijean/auth-ldap/webpack/runtime/define property getters","webpack://@tituspijean/auth-ldap/webpack/runtime/hasOwnProperty shorthand","webpack://@tituspijean/auth-ldap/webpack/runtime/make namespace object"],"names":["flarum","core","compat","LDAPLogInModal","subClass","superClass","prototype","Object","create","constructor","__proto__","oninit","vnode","this","identification","Stream","attrs","password","remember","className","title","app","translationPrefix","server","content","body","footer","fields","toArray","items","ItemList","add","name","type","placeholder","extractText","bidi","disabled","loading","Button","onready","$","select","ldaplogin","data","options","$window","window","url","form","document","createElement","i","setAttribute","hasOwnProperty","input","value","appendChild","open","height","width","submit","removeChild","onsubmit","e","preventDefault","csrfToken","errorHandler","onerror","bind","error","status","alert","children","Modal","extend","HeaderSecondary","has","onclick","remove","LogInModal","SettingsPage","get","length","__webpack_module_cache__","__webpack_require__","moduleId","exports","module","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","defineProperty","enumerable","obj","prop","call","r","Symbol","toStringTag"],"mappings":"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","file":"forum.js","sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/HeaderSecondary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/SettingsPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/LogInModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/SignUpModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/LogInButtons'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['utils/extractText'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['utils/Stream'];","import { extend } from 'flarum/extend';\nimport app from 'flarum/app';\n\nimport Modal from 'flarum/components/Modal';\nimport SignUpModal from 'flarum/components/SignUpModal';\nimport Button from 'flarum/components/Button';\nimport LogInButtons from 'flarum/components/LogInButtons';\nimport extractText from 'flarum/utils/extractText';\nimport ItemList from 'flarum/utils/ItemList';\nimport Stream from 'flarum/utils/Stream';\n\nconst translationPrefix = 'tituspijean-auth-ldap.forum.';\n\nexport default class LDAPLogInModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    /**\n     * The value of the identification input.\n     *\n     * @type {Function}\n     */\n    this.identification = Stream(this.attrs.identification || '');\n\n    /**\n     * The value of the password input.\n     *\n     * @type {Function}\n     */\n    this.password = Stream(this.attrs.password || '');\n\n    /**\n     * The value of the remember me input.\n     *\n     * @type {Function}\n     */\n    this.remember = Stream(!!this.attrs.remember);\n  }\n\n  className() {\n    return 'LogInModal Modal--small';\n  }\n\n  title() {\n    return app.translator.trans(translationPrefix + 'log_in_with', {server: app.forum.attribute('LDAP_method_name')});\n  }\n\n  content() {\n    return [\n      <div className=\"Modal-body\">\n        {this.body()}\n      </div>,\n      <div className=\"Modal-footer\">\n        {this.footer()}\n      </div>\n    ];\n  }\n\n  body() {\n    return [\n      //<LogInButtons/>,\n\n      <div className=\"Form Form--centered\">\n        {this.fields().toArray()}\n      </div>\n    ];\n  }\n\n  fields() {\n    const items = new ItemList();\n\n    items.add('identification', <div className=\"Form-group\">\n      <input className=\"FormControl\" name=\"identification\" type=\"text\" placeholder={extractText(app.translator.trans('core.forum.log_in.username_or_email_placeholder'))}\n        bidi={this.identification}\n        disabled={this.attrs.loading} />\n    </div>, 30);\n\n    items.add('password', <div className=\"Form-group\">\n      <input className=\"FormControl\" name=\"password\" type=\"password\" placeholder={extractText(app.translator.trans('core.forum.log_in.password_placeholder'))}\n        bidi={this.password}\n        disabled={this.attrs.loading} />\n    </div>, 20);\n\n    /*items.add('remember', <div className=\"Form-group\">\n      <div>\n        <label className=\"checkbox\">\n          <input type=\"checkbox\" bidi={this.remember} disabled={this.loading} />\n          {app.translator.trans('core.forum.log_in.remember_me_label')}\n        </label>\n      </div>\n    </div>, 10);*/\n\n    items.add('submit', <div className=\"Form-group\">\n      {Button.component(\n        {\n          className: 'Button Button--primary Button--block',\n          type: 'submit',\n          loading: this.attrs.loading,\n        },\n        app.translator.trans('core.forum.log_in.submit_button')\n      )}\n    </div>, -10);\n\n    return items;\n  }\n\n  footer() {\n    return [\n      /*<p className=\"LogInModal-forgotPassword\">\n        <a onclick={this.forgotPassword.bind(this)}>{app.translator.trans('core.forum.log_in.forgot_password_link')}</a>\n      </p>,\n\n      app.forum.attribute('allowSignUp') ? (\n        <p className=\"LogInModal-signUp\">\n          {app.translator.trans('core.forum.log_in.sign_up_text', {a: <a onclick={this.signUp.bind(this)}/>})}\n        </p>\n      ) : ''*/\n    ];\n  }\n\n  onready() {\n    this.$('[name=' + (this.identification() ? 'password' : 'identification') + ']').select();\n  }\n\n  ldaplogin(data, options = {}) {\n      const width = 600;\n      const height = 400;\n      const $window = $(window);\n      const url = app.forum.attribute('baseUrl') + '/auth/ldap';\n      const name = \"ldapauth\";\n\n      var form = document.createElement(\"form\");\n      form.setAttribute(\"method\", \"POST\");\n      form.setAttribute(\"action\", url);\n      form.setAttribute(\"target\", name);\n      for (var i in data) {\n          if (data.hasOwnProperty(i)) {\n               var input = document.createElement('input');\n               input.type = 'hidden';\n               input.name = i;\n               input.value = data[i];\n               form.appendChild(input);\n           }\n      }\n      document.body.appendChild(form);\n\n      window.open(\"\", name,\n        `width=${width},` +\n        `height=${height},` +\n        `top=${$window.height() / 2 - height / 2},` +\n        `left=${$window.width() / 2 - width / 2},` +\n        'status=no,scrollbars=no,resizable=no');\n\n      form.submit();\n      document.body.removeChild(form);\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    this.loading = true;\n\n    const identification = this.identification();\n    const password = this.password();\n    const remember = this.remember();\n    const csrfToken = app.session.csrfToken;\n\n    this.ldaplogin({identification, password, remember, csrfToken}, {errorHandler: this.onerror.bind(this)})\n  }\n\n  onerror(error) {\n    if (error.status === 401) {\n      error.alert.children = app.translator.trans('core.forum.log_in.invalid_login_message');\n    }\n\n    super.onerror(error);\n  }\n}\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import { extend, override } from 'flarum/extend';\nimport app from 'flarum/app';\n\nimport HeaderSecondary from \"flarum/components/HeaderSecondary\";\nimport SettingsPage from \"flarum/components/SettingsPage\";\nimport Button from 'flarum/components/Button';\n\nimport LogInModal from \"flarum/components/LogInModal\";\nimport LDAPLogInModal from \"./components/LDAPLogInModal\";\n\nconst translationPrefix = 'tituspijean-auth-ldap.forum.';\n\napp.initializers.add('tituspijean-auth-ldap', function() {\n\n\textend(HeaderSecondary.prototype, 'items', addLoginLink);\n\textend(HeaderSecondary.prototype, 'items', removeIfOnlyUse);\n\textend(LogInModal.prototype, 'content', overrideModal);\n\n\textend(SettingsPage.prototype, 'accountItems', removeProfileActions);\n\textend(SettingsPage.prototype, 'settingsItems', checkRemoveAccountSection);\n\n\tfunction overrideModal() {\n\t\tif (app.forum.attribute('onlyUseLDAP')) {\n\t\t\tLogInModal.prototype.content = LDAPLogInModal.prototype.content\n\t\t\tLogInModal.prototype.title = LDAPLogInModal.prototype.title\n\t\t\tLogInModal.prototype.body = LDAPLogInModal.prototype.body\n\t\t\tLogInModal.prototype.fields = LDAPLogInModal.prototype.fields\n\t\t\tLogInModal.prototype.footer = LDAPLogInModal.prototype.footer\n\t\t\tLogInModal.prototype.onsubmit = LDAPLogInModal.prototype.onsubmit\n\t\t}\n\t}\n\n\tfunction addLoginLink(items) {\n\t\tif (items.has('logIn')) {\n\t\t\titems.add('logInLDAP',\n\t\t\t\tButton.component(\n\t\t\t\t  {\n            className: 'Button Button--link',\n            onclick: () => app.modal.show(LDAPLogInModal)\n\t\t\t\t  },\n          app.translator.trans(translationPrefix + 'log_in_with', {server: app.forum.attribute('LDAP_method_name')})\n\t\t\t\t),\n        0\n\t\t\t);\n\t\t}\n\t}\n\n\tfunction removeIfOnlyUse(items) {\n\t\tif (app.forum.attribute('onlyUseLDAP')) {\n\t\t\tif (items.has('signUp')) {\n\t\t\t\titems.remove('signUp');\n\t\t\t}\n\t\t\tif (items.has('logIn')) {\n\t\t\t\titems.remove('logIn');\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction removeProfileActions(items) {\n\t\titems.remove('changeEmail');\n\t\titems.remove('changePassword');\n\t}\n\n\tfunction checkRemoveAccountSection(items) {\n\t\tif (items.has('account') &&\n\t\t\titems.get('account').children.length === 0) {\n\t\t\titems.remove('account');\n\t\t}\n\t}\n});\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(590);\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"sourceRoot":""}